[ 2016-10-07T10:45:37+08:00 ] 121.201.3.223 /admin.php/Index/index.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000037s ]
INFO: [ app_init ] --END-- [ RunTime:0.000628s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000542s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000633s ]

[ 2016-10-07T10:45:37+08:00 ] 121.201.3.223 /admin.php/Login/index.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000024s ]
INFO: [ app_init ] --END-- [ RunTime:0.000415s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000634s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000711s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000084s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000207s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.008391s ]
INFO: [ view_parse ] --END-- [ RunTime:0.008485s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000217s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000266s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000510s ]
INFO: [ app_end ] --END-- [ RunTime:0.000593s ]

[ 2016-10-07T10:46:34+08:00 ] 121.201.3.223 /admin.php/Index/index.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000022s ]
INFO: [ app_init ] --END-- [ RunTime:0.000420s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000477s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000534s ]

[ 2016-10-07T10:46:34+08:00 ] 121.201.3.223 /admin.php/Login/index.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000024s ]
INFO: [ app_init ] --END-- [ RunTime:0.000446s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000482s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000562s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000077s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000164s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.005483s ]
INFO: [ view_parse ] --END-- [ RunTime:0.005536s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000158s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000197s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000506s ]
INFO: [ app_end ] --END-- [ RunTime:0.000552s ]

[ 2016-10-07T10:46:41+08:00 ] 121.201.3.223 /admin.php/Login/Login/login
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000027s ]
INFO: [ app_init ] --END-- [ RunTime:0.000504s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000623s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000704s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0014s ]
SQL: SELECT * FROM `blog_admin` WHERE `name` = 'joychi' AND `password` = 'c1d952863be53323f15d7c87a994e627' LIMIT 1   [ RunTime:0.0004s ]
SQL: UPDATE `blog_admin` SET `login_time`='1475808401',`login_ip`='121.201.3.223' WHERE ( id=1 ) [ RunTime:0.0003s ]
NOTIC: [8] A session had already been started - ignoring session_start() /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Common/functions.php 第 1263 行.
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000931s ]
INFO: [ app_end ] --END-- [ RunTime:0.001014s ]

[ 2016-10-07T10:46:41+08:00 ] 121.201.3.223 /admin.php/Index/index.html
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000039s ]
INFO: [ app_init ] --END-- [ RunTime:0.000709s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000798s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000900s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0009s ]
SQL: SELECT `login_time` FROM `blog_admin` WHERE ( name=0 ) LIMIT 1   [ RunTime:0.0005s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000119s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000237s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.027753s ]
INFO: [ view_parse ] --END-- [ RunTime:0.027927s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000308s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000378s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000798s ]
INFO: [ app_end ] --END-- [ RunTime:0.000874s ]

[ 2016-10-07T10:46:41+08:00 ] 121.201.3.223 /admin.php/Index/showNav
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000023s ]
INFO: [ app_init ] --END-- [ RunTime:0.000412s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000428s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000485s ]
SQL: SHOW COLUMNS FROM `blog_admin_nav` [ RunTime:0.0044s ]
SQL: SELECT `id`,`text`,`state`,`iconCls`,`url` FROM `blog_admin_nav` WHERE `nid` = 0  [ RunTime:0.0026s ]

[ 2016-10-07T10:46:42+08:00 ] 121.201.3.223 /admin.php/Index/showNav
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000032s ]
INFO: [ app_init ] --END-- [ RunTime:0.000631s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000670s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000752s ]
SQL: SHOW COLUMNS FROM `blog_admin_nav` [ RunTime:0.0010s ]
SQL: SELECT `id`,`text`,`state`,`iconCls`,`url` FROM `blog_admin_nav` WHERE `nid` = 1  [ RunTime:0.0003s ]

[ 2016-10-07T10:46:42+08:00 ] 121.201.3.223 /admin.php/Index/showNav
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000036s ]
INFO: [ app_init ] --END-- [ RunTime:0.000654s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000633s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000716s ]
SQL: SHOW COLUMNS FROM `blog_admin_nav` [ RunTime:0.0054s ]
SQL: SELECT `id`,`text`,`state`,`iconCls`,`url` FROM `blog_admin_nav` WHERE `nid` = 8  [ RunTime:0.0004s ]

[ 2016-10-07T10:46:42+08:00 ] 121.201.3.223 /admin.php/Index/showNav
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000030s ]
INFO: [ app_init ] --END-- [ RunTime:0.000586s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000673s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000805s ]
SQL: SHOW COLUMNS FROM `blog_admin_nav` [ RunTime:0.0010s ]
SQL: SELECT `id`,`text`,`state`,`iconCls`,`url` FROM `blog_admin_nav` WHERE `nid` = 5  [ RunTime:0.0003s ]

[ 2016-10-07T10:46:52+08:00 ] 121.201.3.223 /admin.php/Members/index?_=1475808763357
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000034s ]
INFO: [ app_init ] --END-- [ RunTime:0.000513s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000449s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000507s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000087s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000166s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.007976s ]
INFO: [ view_parse ] --END-- [ RunTime:0.008067s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000165s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000203s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000465s ]
INFO: [ app_end ] --END-- [ RunTime:0.000512s ]

[ 2016-10-07T10:46:52+08:00 ] 121.201.3.223 /admin.php/Members/getmembers
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000034s ]
INFO: [ app_init ] --END-- [ RunTime:0.000636s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000715s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000822s ]
SQL: SHOW COLUMNS FROM `blog_members` [ RunTime:0.0010s ]
SQL: SELECT `id`,`m_name`,`email`,`qq`,`reg_time`,`login_time`,`login_ip` FROM `blog_members` ORDER BY `reg_time` DESC LIMIT 0,20   [ RunTime:0.0006s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_members` LIMIT 1   [ RunTime:0.0003s ]

[ 2016-10-07T10:46:57+08:00 ] 121.201.3.223 /admin.php/Article/index?_=1475808763359
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.000498s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000746s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000859s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000119s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000208s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.008396s ]
INFO: [ view_parse ] --END-- [ RunTime:0.008479s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000190s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000412s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000615s ]
INFO: [ app_end ] --END-- [ RunTime:0.000660s ]

[ 2016-10-07T10:46:57+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000036s ]
INFO: [ app_init ] --END-- [ RunTime:0.000678s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000756s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000870s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0012s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0006s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0016s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0002s ]

[ 2016-10-07T10:47:00+08:00 ] 121.201.3.223 /admin.php/Article/index?_=1475808763361
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000032s ]
INFO: [ app_init ] --END-- [ RunTime:0.000542s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000708s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000791s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000116s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000215s ]
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.007919s ]
INFO: [ view_parse ] --END-- [ RunTime:0.007999s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000182s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000224s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000536s ]
INFO: [ app_end ] --END-- [ RunTime:0.000580s ]

[ 2016-10-07T10:47:00+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000030s ]
INFO: [ app_init ] --END-- [ RunTime:0.000626s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000720s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000803s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0007s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0005s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0002s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0001s ]

[ 2016-10-07T10:52:15+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000032s ]
INFO: [ app_init ] --END-- [ RunTime:0.000608s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000714s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000803s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0010s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0017s ]

[ 2016-10-07T10:52:15+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.000419s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000434s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000489s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0012s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0004s ]

[ 2016-10-07T11:35:09+08:00 ] 121.201.3.223 /admin.php/Article/addarticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000030s ]
INFO: [ app_init ] --END-- [ RunTime:0.001869s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001600s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001985s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0013s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: INSERT INTO `blog_article` (`a_title`,`a_intro`,`cate_id`,`a_author`,`create_time`,`a_content`) VALUES ('Web端裁剪图片方法','Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术','1','1','1475811665','&lt;h1&gt;&lt;span style=&quot;font-size:24px&quot;&gt;Web端裁剪图片方法&lt;/span&gt;&lt;/h1&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/p&gt;

&lt;pre&gt;
&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;
&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
 $(function(){
  $(&amp;#39;#cropbox&amp;#39;).Jcrop({
      aspectRatio: 1,
      onSelect: updateCoords
    });

  });
function updateCoords(c)
  {
    $(&amp;#39;#x&amp;#39;).val(c.x);
    $(&amp;#39;#y&amp;#39;).val(c.y);
    $(&amp;#39;#w&amp;#39;).val(c.w);
    $(&amp;#39;#h&amp;#39;).val(c.h);
  };
 function checkCoords()
  {
    if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;
    alert(&amp;#39;请进行裁剪后上传&amp;#39;);
    return false;
  };
&amp;lt;/script&amp;gt;&lt;/big&gt;&lt;/small&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;
if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)
{
   $targ_w = $targ_h = 150;
   $jpeg_quality = 90;

   $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片
   $img_r = imagecreatefromjpeg($src);
   $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );

   imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],
   $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);

   header(&amp;#39;Content-type: image/jpeg&amp;#39;);
   imagejpeg($dst_r,null,$jpeg_quality);
   exit;
}&lt;/pre&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h3&gt;

&lt;h3&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/h3&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;font-size:18px; line-height:28.8px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;

&lt;h3&gt;相关文件可以到群里进行下载&lt;br /&gt;
&amp;nbsp;&lt;/h3&gt;
') [ RunTime:0.0012s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000834s ]
INFO: [ app_end ] --END-- [ RunTime:0.000915s ]

[ 2016-10-07T11:35:09+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000030s ]
INFO: [ app_init ] --END-- [ RunTime:0.000618s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000664s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000745s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0010s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0027s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0003s ]

[ 2016-10-07T11:36:12+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000026s ]
INFO: [ app_init ] --END-- [ RunTime:0.000552s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000447s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000503s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0009s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0003s ]

[ 2016-10-07T11:36:12+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000019s ]
INFO: [ app_init ] --END-- [ RunTime:0.000377s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000398s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000453s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0010s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0003s ]

[ 2016-10-07T11:36:12+08:00 ] 121.201.3.223 /admin.php/Article/getOnearticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000026s ]
INFO: [ app_init ] --END-- [ RunTime:0.000426s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000434s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000488s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0013s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0007s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_intro,ba.a_content,ba.a_views,blog_admin.name,bac.cate_name,ba.create_time,bc.comment,bc.comment_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id left JOIN blog_admin on ba.a_author = blog_admin.id left JOIN blog_comment bc on ba.a_id = bc.aid  WHERE ( a_id=19 ) ORDER BY create_time desc  [ RunTime:0.0009s ]

[ 2016-10-07T11:36:12+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.000453s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000463s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000521s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0008s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0001s ]

[ 2016-10-07T11:36:12+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000017s ]
INFO: [ app_init ] --END-- [ RunTime:0.000437s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000604s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000729s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0007s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0001s ]

[ 2016-10-07T11:36:33+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000042s ]
INFO: [ app_init ] --END-- [ RunTime:0.000708s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000697s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000787s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0012s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475811753',`a_content`='&lt;h1&gt;&lt;span style=&quot;font-size:24px&quot;&gt;Web端裁剪图片方法&lt;/span&gt;&lt;/h1&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/p&gt;

&lt;pre&gt;
&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;
&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
 $(function(){
  $(&amp;#39;#cropbox&amp;#39;).Jcrop({
      aspectRatio: 1,
      onSelect: updateCoords
    });

  });
function updateCoords(c)
  {
    $(&amp;#39;#x&amp;#39;).val(c.x);
    $(&amp;#39;#y&amp;#39;).val(c.y);
    $(&amp;#39;#w&amp;#39;).val(c.w);
    $(&amp;#39;#h&amp;#39;).val(c.h);
  };
 function checkCoords()
  {
    if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;
    alert(&amp;#39;请进行裁剪后上传&amp;#39;);
    return false;
  };
&amp;lt;/script&amp;gt;&lt;/big&gt;&lt;/small&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;
if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)
{
   $targ_w = $targ_h = 150;
   $jpeg_quality = 90;

   $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片
   $img_r = imagecreatefromjpeg($src);
   $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );

   imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],
   $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);

   header(&amp;#39;Content-type: image/jpeg&amp;#39;);
   imagejpeg($dst_r,null,$jpeg_quality);
   exit;
}&lt;/pre&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h3&gt;

&lt;h3&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/h3&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;

&lt;h3&gt;相关文件可以到群里进行下载&lt;br /&gt;
&amp;nbsp;&lt;/h3&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0014s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000892s ]
INFO: [ app_end ] --END-- [ RunTime:0.001075s ]

[ 2016-10-07T11:36:33+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000032s ]
INFO: [ app_init ] --END-- [ RunTime:0.000680s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000723s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000819s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0011s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0012s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0024s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0003s ]

[ 2016-10-07T11:36:51+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000022s ]
INFO: [ app_init ] --END-- [ RunTime:0.000431s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000465s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000531s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0008s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0001s ]

[ 2016-10-07T11:36:51+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000022s ]
INFO: [ app_init ] --END-- [ RunTime:0.000421s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000441s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000493s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0009s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0001s ]

[ 2016-10-07T11:36:52+08:00 ] 121.201.3.223 /admin.php/Article/getOnearticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000029s ]
INFO: [ app_init ] --END-- [ RunTime:0.000552s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000613s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000697s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0005s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_intro,ba.a_content,ba.a_views,blog_admin.name,bac.cate_name,ba.create_time,bc.comment,bc.comment_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id left JOIN blog_admin on ba.a_author = blog_admin.id left JOIN blog_comment bc on ba.a_id = bc.aid  WHERE ( a_id=19 ) ORDER BY create_time desc  [ RunTime:0.0008s ]

[ 2016-10-07T11:36:52+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000023s ]
INFO: [ app_init ] --END-- [ RunTime:0.000423s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000462s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000521s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0007s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0002s ]

[ 2016-10-07T11:36:52+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000030s ]
INFO: [ app_init ] --END-- [ RunTime:0.000561s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000621s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000702s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0007s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0001s ]

[ 2016-10-07T11:38:58+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000036s ]
INFO: [ app_init ] --END-- [ RunTime:0.000692s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000791s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000891s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0015s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475811898',`a_content`='&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/p&gt;

&lt;pre&gt;
&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;
&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
 $(function(){
  $(&amp;#39;#cropbox&amp;#39;).Jcrop({
      aspectRatio: 1,
      onSelect: updateCoords
    });

  });
function updateCoords(c)
  {
    $(&amp;#39;#x&amp;#39;).val(c.x);
    $(&amp;#39;#y&amp;#39;).val(c.y);
    $(&amp;#39;#w&amp;#39;).val(c.w);
    $(&amp;#39;#h&amp;#39;).val(c.h);
  };
 function checkCoords()
  {
    if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;
    alert(&amp;#39;请进行裁剪后上传&amp;#39;);
    return false;
  };
&amp;lt;/script&amp;gt;&lt;/big&gt;&lt;/small&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;
if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)
{
   $targ_w = $targ_h = 150;
   $jpeg_quality = 90;

   $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片
   $img_r = imagecreatefromjpeg($src);
   $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );

   imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],
   $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);

   header(&amp;#39;Content-type: image/jpeg&amp;#39;);
   imagejpeg($dst_r,null,$jpeg_quality);
   exit;
}&lt;/pre&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h3&gt;

&lt;h3&gt;&lt;span style=&quot;font-size:14px&quot;&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/span&gt;&lt;/h3&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0014s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000711s ]
INFO: [ app_end ] --END-- [ RunTime:0.000778s ]

[ 2016-10-07T11:38:58+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000027s ]
INFO: [ app_init ] --END-- [ RunTime:0.000475s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000498s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000557s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0011s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0007s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0025s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0003s ]

[ 2016-10-07T11:39:10+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000023s ]
INFO: [ app_init ] --END-- [ RunTime:0.000411s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000433s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000489s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0008s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0003s ]

[ 2016-10-07T11:39:10+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000036s ]
INFO: [ app_init ] --END-- [ RunTime:0.000675s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000770s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000866s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0009s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0003s ]

[ 2016-10-07T11:39:10+08:00 ] 121.201.3.223 /admin.php/Article/getOnearticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000026s ]
INFO: [ app_init ] --END-- [ RunTime:0.000433s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000452s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000510s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0013s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0007s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_intro,ba.a_content,ba.a_views,blog_admin.name,bac.cate_name,ba.create_time,bc.comment,bc.comment_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id left JOIN blog_admin on ba.a_author = blog_admin.id left JOIN blog_comment bc on ba.a_id = bc.aid  WHERE ( a_id=19 ) ORDER BY create_time desc  [ RunTime:0.0016s ]

[ 2016-10-07T11:39:11+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000040s ]
INFO: [ app_init ] --END-- [ RunTime:0.000807s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000727s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000816s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0012s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0001s ]

[ 2016-10-07T11:39:11+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000028s ]
INFO: [ app_init ] --END-- [ RunTime:0.000573s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000599s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000669s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0008s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0001s ]

[ 2016-10-07T11:39:39+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000038s ]
INFO: [ app_init ] --END-- [ RunTime:0.000676s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000720s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000801s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0011s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475811898',`a_content`='&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h1&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/p&gt;

&lt;pre&gt;
&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;
&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
 $(function(){
  $(&amp;#39;#cropbox&amp;#39;).Jcrop({
      aspectRatio: 1,
      onSelect: updateCoords
    });

  });
function updateCoords(c)
  {
    $(&amp;#39;#x&amp;#39;).val(c.x);
    $(&amp;#39;#y&amp;#39;).val(c.y);
    $(&amp;#39;#w&amp;#39;).val(c.w);
    $(&amp;#39;#h&amp;#39;).val(c.h);
  };
 function checkCoords()
  {
    if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;
    alert(&amp;#39;请进行裁剪后上传&amp;#39;);
    return false;
  };
&amp;lt;/script&amp;gt;&lt;/big&gt;&lt;/small&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;
if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)
{
   $targ_w = $targ_h = 150;
   $jpeg_quality = 90;

   $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片
   $img_r = imagecreatefromjpeg($src);
   $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );

   imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],
   $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);

   header(&amp;#39;Content-type: image/jpeg&amp;#39;);
   imagejpeg($dst_r,null,$jpeg_quality);
   exit;
}&lt;/pre&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h3&gt;

&lt;h3&gt;&lt;span style=&quot;font-size:14px&quot;&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/span&gt;&lt;/h3&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0013s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000841s ]
INFO: [ app_end ] --END-- [ RunTime:0.000915s ]

[ 2016-10-07T11:39:40+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000023s ]
INFO: [ app_init ] --END-- [ RunTime:0.000422s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000432s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000488s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0008s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0004s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0020s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0003s ]

[ 2016-10-07T11:39:57+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.000418s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000422s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000476s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0011s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0001s ]

[ 2016-10-07T11:39:57+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000030s ]
INFO: [ app_init ] --END-- [ RunTime:0.000682s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000677s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000802s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0012s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0001s ]

[ 2016-10-07T11:39:57+08:00 ] 121.201.3.223 /admin.php/Article/getOnearticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000032s ]
INFO: [ app_init ] --END-- [ RunTime:0.000616s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000648s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000739s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0019s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0032s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_intro,ba.a_content,ba.a_views,blog_admin.name,bac.cate_name,ba.create_time,bc.comment,bc.comment_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id left JOIN blog_admin on ba.a_author = blog_admin.id left JOIN blog_comment bc on ba.a_id = bc.aid  WHERE ( a_id=19 ) ORDER BY create_time desc  [ RunTime:0.0010s ]

[ 2016-10-07T11:39:57+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000024s ]
INFO: [ app_init ] --END-- [ RunTime:0.000413s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000433s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000509s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0008s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0001s ]

[ 2016-10-07T11:39:57+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000035s ]
INFO: [ app_init ] --END-- [ RunTime:0.000726s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000748s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000850s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0009s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0002s ]

[ 2016-10-07T11:41:03+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000032s ]
INFO: [ app_init ] --END-- [ RunTime:0.000644s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000661s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000766s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0011s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475812023',`a_content`='&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h1&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/h1&gt;

&lt;h1&gt;&lt;span style=&quot;font-size:14px&quot;&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/span&gt;&lt;/h1&gt;

&lt;pre&gt;
&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;
&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
 $(function(){
  $(&amp;#39;#cropbox&amp;#39;).Jcrop({
      aspectRatio: 1,
      onSelect: updateCoords
    });

  });
function updateCoords(c)
  {
    $(&amp;#39;#x&amp;#39;).val(c.x);
    $(&amp;#39;#y&amp;#39;).val(c.y);
    $(&amp;#39;#w&amp;#39;).val(c.w);
    $(&amp;#39;#h&amp;#39;).val(c.h);
  };
 function checkCoords()
  {
    if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;
    alert(&amp;#39;请进行裁剪后上传&amp;#39;);
    return false;
  };
&amp;lt;/script&amp;gt;&lt;/big&gt;&lt;/small&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;
if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)
{
   $targ_w = $targ_h = 150;
   $jpeg_quality = 90;

   $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片
   $img_r = imagecreatefromjpeg($src);
   $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );

   imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],
   $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);

   header(&amp;#39;Content-type: image/jpeg&amp;#39;);
   imagejpeg($dst_r,null,$jpeg_quality);
   exit;
}&lt;/pre&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h3&gt;&lt;span style=&quot;font-size:14px&quot;&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/span&gt;&lt;/h3&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0009s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000621s ]
INFO: [ app_end ] --END-- [ RunTime:0.000672s ]

[ 2016-10-07T11:41:03+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000034s ]
INFO: [ app_init ] --END-- [ RunTime:0.000707s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000744s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000835s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0007s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0027s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0003s ]

[ 2016-10-07T11:41:47+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.000414s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000436s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000488s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0010s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0003s ]

[ 2016-10-07T11:41:48+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000034s ]
INFO: [ app_init ] --END-- [ RunTime:0.000624s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000696s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000786s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0011s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0002s ]

[ 2016-10-07T11:41:48+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000023s ]
INFO: [ app_init ] --END-- [ RunTime:0.000411s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000425s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000477s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0008s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0002s ]

[ 2016-10-07T11:41:48+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000027s ]
INFO: [ app_init ] --END-- [ RunTime:0.000546s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000613s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000689s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0006s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0002s ]

[ 2016-10-07T11:44:03+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000033s ]
INFO: [ app_init ] --END-- [ RunTime:0.000626s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000730s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000809s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0011s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0006s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0022s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0004s ]

[ 2016-10-07T11:44:05+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.000433s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000457s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000512s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0008s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0003s ]

[ 2016-10-07T11:44:05+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000023s ]
INFO: [ app_init ] --END-- [ RunTime:0.000411s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000408s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000463s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0005s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0003s ]

[ 2016-10-07T11:44:05+08:00 ] 121.201.3.223 /admin.php/Article/getOnearticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000024s ]
INFO: [ app_init ] --END-- [ RunTime:0.000464s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000448s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000505s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0011s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0005s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_intro,ba.a_content,ba.a_views,blog_admin.name,bac.cate_name,ba.create_time,bc.comment,bc.comment_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id left JOIN blog_admin on ba.a_author = blog_admin.id left JOIN blog_comment bc on ba.a_id = bc.aid  WHERE ( a_id=19 ) ORDER BY create_time desc  [ RunTime:0.0010s ]

[ 2016-10-07T11:44:05+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.000502s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000441s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000499s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0008s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0002s ]

[ 2016-10-07T11:44:05+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000029s ]
INFO: [ app_init ] --END-- [ RunTime:0.000580s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000622s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000697s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0011s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0002s ]

[ 2016-10-07T11:44:19+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000023s ]
INFO: [ app_init ] --END-- [ RunTime:0.000442s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000440s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000493s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0009s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475812219',`a_content`='&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h1&gt;&lt;span style=&quot;font-size:14px&quot;&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/span&gt;&lt;/h1&gt;

&lt;p&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;&lt;br /&gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;&lt;br /&gt;
$(function(){&lt;br /&gt;
&amp;nbsp; $(&amp;#39;#cropbox&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; aspectRatio: 1,&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; });&lt;/big&gt;&lt;/small&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp; });&lt;br /&gt;
function updateCoords(c)&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#x&amp;#39;).val(c.x);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#y&amp;#39;).val(c.y);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#w&amp;#39;).val(c.w);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#h&amp;#39;).val(c.h);&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
function checkCoords()&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;请进行裁剪后上传&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
&amp;lt;/script&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)&lt;br /&gt;
{&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w = $targ_h = 150;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $jpeg_quality = 90;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $img_r = imagecreatefromjpeg($src);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; header(&amp;#39;Content-type: image/jpeg&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; imagejpeg($dst_r,null,$jpeg_quality);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; exit;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span style=&quot;font-size:14px&quot;&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h2&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0012s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000637s ]
INFO: [ app_end ] --END-- [ RunTime:0.000693s ]

[ 2016-10-07T11:44:19+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000024s ]
INFO: [ app_init ] --END-- [ RunTime:0.000414s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000428s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000484s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0009s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0005s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0017s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0002s ]

[ 2016-10-07T11:44:41+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.000468s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000439s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000499s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0010s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0002s ]

[ 2016-10-07T11:44:41+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000024s ]
INFO: [ app_init ] --END-- [ RunTime:0.000471s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000459s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000517s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0009s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0001s ]

[ 2016-10-07T11:44:41+08:00 ] 121.201.3.223 /admin.php/Article/getOnearticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000024s ]
INFO: [ app_init ] --END-- [ RunTime:0.000464s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000436s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000489s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0009s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0005s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_intro,ba.a_content,ba.a_views,blog_admin.name,bac.cate_name,ba.create_time,bc.comment,bc.comment_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id left JOIN blog_admin on ba.a_author = blog_admin.id left JOIN blog_comment bc on ba.a_id = bc.aid  WHERE ( a_id=19 ) ORDER BY create_time desc  [ RunTime:0.0006s ]

[ 2016-10-07T11:44:42+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000031s ]
INFO: [ app_init ] --END-- [ RunTime:0.000587s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000614s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000688s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0007s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0001s ]

[ 2016-10-07T11:44:42+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.000418s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000442s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000498s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0008s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0001s ]

[ 2016-10-07T11:46:21+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000020s ]
INFO: [ app_init ] --END-- [ RunTime:0.000391s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000433s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000486s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0010s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475812219',`a_content`='&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h1&gt;&lt;span style=&quot;font-size:14px&quot;&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/span&gt;&lt;/h1&gt;

&lt;p&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;&lt;br /&gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;&lt;br /&gt;
$(function(){&lt;br /&gt;
&amp;nbsp; $(&amp;#39;#cropbox&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; aspectRatio: 1,&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; });&lt;/big&gt;&lt;/small&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp; });&lt;br /&gt;
function updateCoords(c)&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#x&amp;#39;).val(c.x);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#y&amp;#39;).val(c.y);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#w&amp;#39;).val(c.w);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#h&amp;#39;).val(c.h);&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
function checkCoords()&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;请进行裁剪后上传&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
&amp;lt;/script&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)&lt;br /&gt;
{&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w = $targ_h = 150;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $jpeg_quality = 90;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $img_r = imagecreatefromjpeg($src);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; header(&amp;#39;Content-type: image/jpeg&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; imagejpeg($dst_r,null,$jpeg_quality);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; exit;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span style=&quot;font-size:14px&quot;&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h2&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0008s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000435s ]
INFO: [ app_end ] --END-- [ RunTime:0.000483s ]

[ 2016-10-07T11:46:23+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000020s ]
INFO: [ app_init ] --END-- [ RunTime:0.000393s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000451s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000516s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0009s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475812219',`a_content`='&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h1&gt;&lt;span style=&quot;font-size:14px&quot;&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/span&gt;&lt;/h1&gt;

&lt;p&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;&lt;br /&gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;&lt;br /&gt;
$(function(){&lt;br /&gt;
&amp;nbsp; $(&amp;#39;#cropbox&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; aspectRatio: 1,&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; });&lt;/big&gt;&lt;/small&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp; });&lt;br /&gt;
function updateCoords(c)&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#x&amp;#39;).val(c.x);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#y&amp;#39;).val(c.y);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#w&amp;#39;).val(c.w);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#h&amp;#39;).val(c.h);&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
function checkCoords()&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;请进行裁剪后上传&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
&amp;lt;/script&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)&lt;br /&gt;
{&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w = $targ_h = 150;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $jpeg_quality = 90;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $img_r = imagecreatefromjpeg($src);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; header(&amp;#39;Content-type: image/jpeg&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; imagejpeg($dst_r,null,$jpeg_quality);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; exit;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span style=&quot;font-size:14px&quot;&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h2&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0011s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000969s ]
INFO: [ app_end ] --END-- [ RunTime:0.001044s ]

[ 2016-10-07T11:46:31+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000023s ]
INFO: [ app_init ] --END-- [ RunTime:0.000406s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000430s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000483s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0007s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475812348',`a_content`='&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h1&gt;&lt;span style=&quot;font-size:14px&quot;&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/span&gt;&lt;/h1&gt;

&lt;p&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;&lt;br /&gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;&lt;br /&gt;
$(function(){&lt;br /&gt;
&amp;nbsp; $(&amp;#39;#cropbox&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; aspectRatio: 1,&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; });&lt;/big&gt;&lt;/small&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp; });&lt;br /&gt;
function updateCoords(c)&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#x&amp;#39;).val(c.x);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#y&amp;#39;).val(c.y);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#w&amp;#39;).val(c.w);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#h&amp;#39;).val(c.h);&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
function checkCoords()&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;请进行裁剪后上传&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
&amp;lt;/script&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)&lt;br /&gt;
{&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w = $targ_h = 150;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $jpeg_quality = 90;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $img_r = imagecreatefromjpeg($src);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; header(&amp;#39;Content-type: image/jpeg&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; imagejpeg($dst_r,null,$jpeg_quality);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; exit;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span style=&quot;font-size:14px&quot;&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h2&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0009s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000576s ]
INFO: [ app_end ] --END-- [ RunTime:0.000630s ]

[ 2016-10-07T11:46:31+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000022s ]
INFO: [ app_init ] --END-- [ RunTime:0.000414s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000521s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000674s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0007s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0026s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0003s ]

[ 2016-10-07T11:46:55+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.000488s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000587s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000658s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0011s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0003s ]

[ 2016-10-07T11:46:55+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000023s ]
INFO: [ app_init ] --END-- [ RunTime:0.000444s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001948s ]
INFO: [ app_begin ] --END-- [ RunTime:0.002059s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0013s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0003s ]

[ 2016-10-07T11:46:55+08:00 ] 121.201.3.223 /admin.php/Article/getOnearticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000027s ]
INFO: [ app_init ] --END-- [ RunTime:0.000548s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000649s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000725s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0011s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0006s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_intro,ba.a_content,ba.a_views,blog_admin.name,bac.cate_name,ba.create_time,bc.comment,bc.comment_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id left JOIN blog_admin on ba.a_author = blog_admin.id left JOIN blog_comment bc on ba.a_id = bc.aid  WHERE ( a_id=19 ) ORDER BY create_time desc  [ RunTime:0.0010s ]

[ 2016-10-07T11:46:56+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000020s ]
INFO: [ app_init ] --END-- [ RunTime:0.000385s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000394s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000446s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0006s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0001s ]

[ 2016-10-07T11:46:56+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000020s ]
INFO: [ app_init ] --END-- [ RunTime:0.000414s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000418s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000474s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0006s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0002s ]

[ 2016-10-07T11:47:34+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.000433s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000509s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000584s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0011s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475812348',`a_content`='&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h1&gt;&amp;nbsp;&lt;/h1&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;&lt;br /&gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;&lt;br /&gt;
$(function(){&lt;br /&gt;
&amp;nbsp; $(&amp;#39;#cropbox&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; aspectRatio: 1,&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; });&lt;/big&gt;&lt;/small&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp; });&lt;br /&gt;
function updateCoords(c)&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#x&amp;#39;).val(c.x);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#y&amp;#39;).val(c.y);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#w&amp;#39;).val(c.w);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#h&amp;#39;).val(c.h);&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
function checkCoords()&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;请进行裁剪后上传&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
&amp;lt;/script&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)&lt;br /&gt;
{&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w = $targ_h = 150;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $jpeg_quality = 90;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $img_r = imagecreatefromjpeg($src);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; header(&amp;#39;Content-type: image/jpeg&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; imagejpeg($dst_r,null,$jpeg_quality);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; exit;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span style=&quot;font-size:14px&quot;&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h2&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0014s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000864s ]
INFO: [ app_end ] --END-- [ RunTime:0.000940s ]

[ 2016-10-07T11:47:34+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000028s ]
INFO: [ app_init ] --END-- [ RunTime:0.000541s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000626s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000713s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0008s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0005s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0029s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0003s ]

[ 2016-10-07T11:47:42+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000025s ]
INFO: [ app_init ] --END-- [ RunTime:0.000447s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000710s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000792s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0008s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0002s ]

[ 2016-10-07T11:47:42+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000019s ]
INFO: [ app_init ] --END-- [ RunTime:0.000472s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000443s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000505s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0008s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0002s ]

[ 2016-10-07T11:47:42+08:00 ] 121.201.3.223 /admin.php/Article/getOnearticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000031s ]
INFO: [ app_init ] --END-- [ RunTime:0.000604s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000705s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000793s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0006s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_intro,ba.a_content,ba.a_views,blog_admin.name,bac.cate_name,ba.create_time,bc.comment,bc.comment_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id left JOIN blog_admin on ba.a_author = blog_admin.id left JOIN blog_comment bc on ba.a_id = bc.aid  WHERE ( a_id=19 ) ORDER BY create_time desc  [ RunTime:0.0006s ]

[ 2016-10-07T11:47:42+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000029s ]
INFO: [ app_init ] --END-- [ RunTime:0.000572s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000671s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000757s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0006s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0001s ]

[ 2016-10-07T11:47:42+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000026s ]
INFO: [ app_init ] --END-- [ RunTime:0.000546s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000714s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000798s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0009s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0002s ]

[ 2016-10-07T11:48:28+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000024s ]
INFO: [ app_init ] --END-- [ RunTime:0.000407s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000431s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000503s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0015s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475812348',`a_content`='&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h2&gt;&lt;span style=&quot;font-size:14px&quot;&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/span&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;&lt;br /&gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;&lt;br /&gt;
$(function(){&lt;br /&gt;
&amp;nbsp; $(&amp;#39;#cropbox&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; aspectRatio: 1,&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; });&lt;/big&gt;&lt;/small&gt;&lt;/p&gt;

&lt;p&gt;});&lt;br /&gt;
function updateCoords(c)&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#x&amp;#39;).val(c.x);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#y&amp;#39;).val(c.y);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#w&amp;#39;).val(c.w);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#h&amp;#39;).val(c.h);&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
function checkCoords()&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;请进行裁剪后上传&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
&amp;lt;/script&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)&lt;br /&gt;
{&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w = $targ_h = 150;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $jpeg_quality = 90;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $img_r = imagecreatefromjpeg($src);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; header(&amp;#39;Content-type: image/jpeg&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; imagejpeg($dst_r,null,$jpeg_quality);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; exit;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span style=&quot;font-size:14px&quot;&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h2&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0014s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.002568s ]
INFO: [ app_end ] --END-- [ RunTime:0.002667s ]

[ 2016-10-07T11:48:29+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000031s ]
INFO: [ app_init ] --END-- [ RunTime:0.000546s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000692s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000793s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0011s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0010s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0026s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0003s ]

[ 2016-10-07T11:51:01+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.000409s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000450s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000505s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0010s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0004s ]

[ 2016-10-07T11:51:01+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000044s ]
INFO: [ app_init ] --END-- [ RunTime:0.000678s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000747s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000824s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0012s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0006s ]

[ 2016-10-07T11:51:01+08:00 ] 121.201.3.223 /admin.php/Article/getOnearticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000028s ]
INFO: [ app_init ] --END-- [ RunTime:0.000561s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000445s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000506s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0005s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_intro,ba.a_content,ba.a_views,blog_admin.name,bac.cate_name,ba.create_time,bc.comment,bc.comment_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id left JOIN blog_admin on ba.a_author = blog_admin.id left JOIN blog_comment bc on ba.a_id = bc.aid  WHERE ( a_id=19 ) ORDER BY create_time desc  [ RunTime:0.0009s ]

[ 2016-10-07T11:51:01+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000027s ]
INFO: [ app_init ] --END-- [ RunTime:0.000457s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000422s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000482s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0008s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0002s ]

[ 2016-10-07T11:51:01+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000028s ]
INFO: [ app_init ] --END-- [ RunTime:0.000578s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000656s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000734s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0008s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0002s ]

[ 2016-10-07T11:52:44+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000027s ]
INFO: [ app_init ] --END-- [ RunTime:0.000518s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000452s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000506s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0010s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475812724',`a_content`='&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span style=&quot;font-size:14px&quot;&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;

&lt;p&gt;&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;&lt;br /&gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;&lt;br /&gt;
$(function(){&lt;br /&gt;
&amp;nbsp; $(&amp;#39;#cropbox&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; aspectRatio: 1,&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; });&lt;/big&gt;&lt;/small&gt;&lt;/p&gt;

&lt;p&gt;});&lt;br /&gt;
function updateCoords(c)&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#x&amp;#39;).val(c.x);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#y&amp;#39;).val(c.y);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#w&amp;#39;).val(c.w);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#h&amp;#39;).val(c.h);&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
function checkCoords()&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;请进行裁剪后上传&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
&amp;lt;/script&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)&lt;br /&gt;
{&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w = $targ_h = 150;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $jpeg_quality = 90;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $img_r = imagecreatefromjpeg($src);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; header(&amp;#39;Content-type: image/jpeg&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; imagejpeg($dst_r,null,$jpeg_quality);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; exit;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span style=&quot;font-size:14px&quot;&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h2&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0009s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000627s ]
INFO: [ app_end ] --END-- [ RunTime:0.000685s ]

[ 2016-10-07T11:52:45+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000030s ]
INFO: [ app_init ] --END-- [ RunTime:0.000573s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000644s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000718s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0008s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0005s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0019s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0002s ]

[ 2016-10-07T11:53:06+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000022s ]
INFO: [ app_init ] --END-- [ RunTime:0.000426s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000428s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000482s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0009s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0002s ]

[ 2016-10-07T11:53:06+08:00 ] 121.201.3.223 /admin.php/Article/getOnearticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000039s ]
INFO: [ app_init ] --END-- [ RunTime:0.000424s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000438s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000508s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0005s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_intro,ba.a_content,ba.a_views,blog_admin.name,bac.cate_name,ba.create_time,bc.comment,bc.comment_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id left JOIN blog_admin on ba.a_author = blog_admin.id left JOIN blog_comment bc on ba.a_id = bc.aid  WHERE ( a_id=19 ) ORDER BY create_time desc  [ RunTime:0.0009s ]

[ 2016-10-07T11:53:06+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000036s ]
INFO: [ app_init ] --END-- [ RunTime:0.000528s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000413s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000470s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0009s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0003s ]

[ 2016-10-07T11:53:07+08:00 ] 121.201.3.223 /admin.php/Admin/getAdmins
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000030s ]
INFO: [ app_init ] --END-- [ RunTime:0.000608s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000483s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000538s ]
SQL: SHOW COLUMNS FROM `blog_admin` [ RunTime:0.0009s ]
SQL: SELECT `id`,`name`,`login_time`,`login_ip` FROM `blog_admin`  [ RunTime:0.0002s ]

[ 2016-10-07T11:53:07+08:00 ] 121.201.3.223 /admin.php/Article/getcate
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000031s ]
INFO: [ app_init ] --END-- [ RunTime:0.000653s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000688s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000791s ]
SQL: SHOW COLUMNS FROM `blog_article_cate` [ RunTime:0.0007s ]
SQL: SELECT `cate_id`,`cate_name` FROM `blog_article_cate`  [ RunTime:0.0002s ]

[ 2016-10-07T11:54:31+08:00 ] 121.201.3.223 /admin.php/Article/updateArticle
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000021s ]
INFO: [ app_init ] --END-- [ RunTime:0.000430s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000413s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000467s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0022s ]
NOTIC: [8] Undefined index: validate /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1185 行.
NOTIC: [8] Undefined index: auto /home/jijialexjii1jbiia9lce/wwwroot/ThinkPHP/Library/Think/Model.class.php 第 1128 行.
SQL: UPDATE `blog_article` SET `a_title`='Web端裁剪图片方法',`a_intro`='Web端裁剪图片方法，方法一发送坐标到后台裁剪，方法二利用html5的canvas技术',`cate_id`='1',`a_author`='1',`create_time`='1475812829',`a_content`='&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法一：发送坐标到后台，后台就进行裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：使用input上传图片到后台，后台并返回图片的url到img标签的src&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span style=&quot;font-size:14px&quot;&gt;&amp;lt;input id=&amp;quot;image&amp;quot; type=&amp;quot;file&amp;quot; name=&amp;quot;image&amp;quot; /&amp;gt;&lt;/span&gt;&lt;/p&gt;

&lt;h2&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤2：用jcrop插件进行裁剪，获取图片的坐标及长宽等值，传回后台&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;

&lt;p&gt;&amp;lt;img src=&amp;quot;demo_files/test.jpg&amp;quot; id=&amp;quot;cropbox&amp;quot; /&amp;gt;&lt;br /&gt;
&lt;small&gt;&lt;big&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;&lt;br /&gt;
$(function(){&lt;br /&gt;
&amp;nbsp; $(&amp;#39;#cropbox&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; aspectRatio: 1,&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; });&lt;/big&gt;&lt;/small&gt;&lt;/p&gt;

&lt;p&gt;});&lt;br /&gt;
function updateCoords(c)&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#x&amp;#39;).val(c.x);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#y&amp;#39;).val(c.y);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#w&amp;#39;).val(c.w);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; $(&amp;#39;#h&amp;#39;).val(c.h);&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
function checkCoords()&lt;br /&gt;
&amp;nbsp; {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; if (parseInt($(&amp;#39;#w&amp;#39;).val())) return true;&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;请进行裁剪后上传&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp; return false;&lt;br /&gt;
&amp;nbsp; };&lt;br /&gt;
&amp;lt;/script&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop1.png&quot; style=&quot;height:451px; width:552px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤3：后台获取前台发来的坐标,裁剪成新的图片,以PHP为例&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;if ($_SERVER[&amp;#39;REQUEST_METHOD&amp;#39;] == &amp;#39;POST&amp;#39;)&lt;br /&gt;
{&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w = $targ_h = 150;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $jpeg_quality = 90;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; $src = &amp;#39;demo_files/pool.jpg&amp;#39;; //这里假设是前台已经上传过来的图片&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $img_r = imagecreatefromjpeg($src);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $dst_r = ImageCreateTrueColor( $targ_w, $targ_h );&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; imagecopyresampled($dst_r,$img_r,0,0,$_POST[&amp;#39;x&amp;#39;],$_POST[&amp;#39;y&amp;#39;],&lt;br /&gt;
&amp;nbsp;&amp;nbsp; $targ_w,$targ_h,$_POST[&amp;#39;w&amp;#39;],$_POST[&amp;#39;h&amp;#39;]);&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; header(&amp;#39;Content-type: image/jpeg&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; imagejpeg($dst_r,null,$jpeg_quality);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; exit;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;&lt;img alt=&quot;&quot; src=&quot;http://www.ice-breaker.cn/Uploads/images/2016-09-27/jcrop2.png&quot; style=&quot;height:758px; width:521px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;h1&gt;&lt;span style=&quot;color:#ff0000&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;方法二：利用HTML5 canvas进行前端裁剪&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/h1&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤1：读取文件&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;span style=&quot;font-size:14px&quot;&gt;$(&amp;#39;#file&amp;#39;).on(&amp;#39;change&amp;#39;,function(){&lt;br /&gt;
&amp;nbsp;preImg(this.id,&amp;#39;element_id&amp;#39;)&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#myModal&amp;#39;).modal(&amp;#39;show&amp;#39;);&lt;br /&gt;
&amp;nbsp;$(&amp;#39;#element_id&amp;#39;).Jcrop({&lt;br /&gt;
&amp;nbsp; &amp;nbsp;aspectRatio: 1,&lt;br /&gt;
&amp;nbsp; &amp;nbsp;onSelect: updateCoords&lt;br /&gt;
&amp;nbsp;});&lt;br /&gt;
&amp;nbsp;var file=this.files[0];&lt;br /&gt;
&amp;nbsp;var reader=new FileReader();&lt;br /&gt;
&amp;nbsp;reader.onload=function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; // 通过 reader.result 来访问生成的 DataURL&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url=reader.result;&lt;br /&gt;
&amp;nbsp; &amp;nbsp;setImageURL(url);&lt;br /&gt;
&amp;nbsp;};&lt;br /&gt;
&amp;nbsp;reader.readAsDataURL(file);&lt;br /&gt;
});&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;function getFileUrl(sourceId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; var url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; if (navigator.userAgent.indexOf(&amp;quot;MSIE&amp;quot;)&amp;gt;=1) { // IE&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = document.getElementById(sourceId).value;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Firefox&amp;quot;)&amp;gt;0) { // Firefox&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp; } else if(navigator.userAgent.indexOf(&amp;quot;Chrome&amp;quot;)&amp;gt;0) { // Chrome&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));&lt;br /&gt;
&amp;nbsp;&amp;nbsp;}&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;return url;&lt;br /&gt;
}&lt;/p&gt;

&lt;p&gt;/**&lt;br /&gt;
&amp;nbsp; * 将用户本地选择的图片 不通过后台直接显示到浏览器上&lt;br /&gt;
*/&lt;br /&gt;
function preImg(sourceId, targetId) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var url = getFileUrl(sourceId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;var imgPre = document.getElementById(targetId);&lt;br /&gt;
&amp;nbsp;&amp;nbsp;imgPre.src = url;&lt;br /&gt;
}&lt;/p&gt;

&lt;h2&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;步骤2：参见方法一的步骤2&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;h2&gt;&lt;span style=&quot;font-size:18px&quot;&gt;&lt;strong&gt;步骤3：获取jcrop裁剪的坐标后，&lt;/strong&gt;&lt;/span&gt;&lt;strong&gt;&lt;span style=&quot;font-size:18px&quot;&gt;利用canvas重绘图片，并生成新图片base64数据&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;var image=new Image();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;function setImageURL(url){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;image.src=url;&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(&amp;#39;.upload&amp;#39;).click(function(){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(checkCoords()){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var x = $(&amp;#39;#x&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var y = $(&amp;#39;#y&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var width = $(&amp;#39;#w&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var height = $(&amp;#39;#h&amp;#39;).val();&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var canvas=$(&amp;#39;&amp;lt;canvas width=&amp;quot;&amp;#39;+width+&amp;#39;&amp;quot; height=&amp;quot;&amp;#39;+height+&amp;#39;&amp;quot;&amp;gt;&amp;lt;/canvas&amp;gt;&amp;#39;)[0], //此处可以查看canvas裁剪后的效果 并获取该图像的base64编码&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx=canvas.getContext(&amp;#39;2d&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ctx.drawImage(image,x,y,width,height,0,0,width,height);//重绘&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;$(document.body).append(canvas);//添加到文档中可以查看效果&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;var data=canvas.toDataURL(); //得到裁剪后的图片base64位数据&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; $.ajax({&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;type: &amp;quot;POST&amp;quot;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;url: thinkphp.url + &amp;#39;User/upload&amp;#39;,&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;data: {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;#39;img&amp;#39;:data&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;beforeSend: function () {&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; alert(&amp;#39;上传中....&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;},&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;success: function (resp) {&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;if(resp == 1){&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; alert(&amp;#39;上传成功.&amp;#39;);&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;})&lt;br /&gt;
&amp;nbsp;&amp;nbsp; &amp;nbsp;}&lt;/p&gt;
' WHERE ( a_id=19 ) [ RunTime:0.0010s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000637s ]
INFO: [ app_end ] --END-- [ RunTime:0.000761s ]

[ 2016-10-07T11:54:32+08:00 ] 121.201.3.223 /admin.php/Article/getarticles
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000033s ]
INFO: [ app_init ] --END-- [ RunTime:0.000584s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000702s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000788s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0009s ]
SQL: SHOW COLUMNS FROM `blog_article` [ RunTime:0.0005s ]
SQL: SELECT ba.a_id,ba.a_title,ba.a_content,ba.a_views,ba.a_type,blog_admin.name,bac.cate_name,ba.create_time FROM blog_article ba left JOIN blog_article_cate bac on ba.cate_id = bac.cate_id INNER JOIN blog_admin on ba.a_author = blog_admin.id  ORDER BY `create_time` DESC LIMIT 0,20   [ RunTime:0.0018s ]
SQL: SELECT COUNT(*) AS tp_count FROM `blog_article` LIMIT 1   [ RunTime:0.0002s ]

